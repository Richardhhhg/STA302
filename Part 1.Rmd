# Phase 1!

## Loading Files and Data Cleaning

```{r message=FALSE, warning=FALSE, results='hide'}
# required packages
install.packages("readxl")
install.packages("dplyr")
install.packages("ggplot2")
install.packages("tidyverse")
install.packages("corrplot")
```

```{r}
# converting xlsx to csv, only needs to be run once
library(readxl)
library(dplyr)
data <- read_excel("data_academic_performance.xlsx")
write.csv(data, "data.csv") # cuz xlsx is not epic
df <- read.csv("data.csv")

df <- df %>% select(-X)
```

```{r}
head(df)
```

## Data Cleaning

TODO: DO THIS THING

```{r}
df_clean <- df %>% 
  mutate("AVG_S11" = (MAT_S11 + CR_S11 + CC_S11 + BIO_S11 + ENG_S11) / 5) %>%
  select(G_SC, AVG_S11, GENDER, SCHOOL_NAT, SEL, SEL_IHE)

```

```{r}
# IM EXPERIMENTING HERE DON'T JUDGE

library(ggplot2)
library(GGally)

# Convert categorical variables to factors
#df_clean$GENDER <- as.factor(df$GENDER)
#df_clean$SCHOOL_NAT <- as.factor(df$SCHOOL_NAT)

ggpairs(df_clean, 
        aes(color = GENDER),  
        lower = list(continuous = wrap("points", alpha = 0.5)),  # Scatterplot for numeric vs numeric
        upper = list(continuous = wrap("points", alpha = 0.5)),  # Scatterplot in upper triangle too
        diag = list(continuous = wrap("densityDiag")),           # Density plots for numeric vars
        combo = list(continuous = wrap("box_no_facet")))         # Boxplot for categorical vs numeric
```


## Data Visualization

### Summary Statistics

```{r}
library(ggplot2)
library(tidyr)
library(corrplot)
```

```{r}
summary(df)
```

### Visualizations for Numeric Data

```{r}
# filtering for continuous variables
df_numeric <- df %>% 
  select(where(is.numeric)) %>%
  select(where(~ length(unique(.)) > 5))
head(df_numeric)
```

```{r}
lapply(names(df_numeric), function(col) {
  ggplot(df_numeric, aes(x = .data[[col]])) +
    geom_histogram(bins = 50) +
    labs(title = paste("Distribution of ", col))
})
```

```{r}
# correlation matrix
cor_matrix <- cor(df_numeric, use = "complete.obs")
corrplot(cor_matrix, method = "circle")
```

```{r}
# Relationship between G_SC and S11 tests
df_numerical_temp <- select(df_numeric, -c(QR_PRO, CR_PRO, CC_PRO, ENG_PRO, WC_PRO, FEP_PRO, PERCENTILE))
plot(df_numerical_temp, pch = 19, cex = 0.10)
```

```{r}
# Relationship between G_SC and PRO tests
df_numerical_temp <- select(df_numeric, -c(MAT_S11, CR_S11, CC_S11, BIO_S11, ENG_S11, PERCENTILE))
plot(df_numerical_temp, pch = 19, cex = 0.10)
```

```{r}
# making aggregate average for S11 exams
df_numeric$COD_S11 <- rowMeans(select(df_numeric, c(MAT_S11, CR_S11, CC_S11, BIO_S11, ENG_S11)), na.rm = TRUE)
plot(df_numeric$COD_S11, df_numeric$G_SC, pch = 19, cex = 0.5)
```

### Visualizing Categorical Data

```{r}
continuous_cols <- colnames(df_numeric)
df_categorical <- select(df, -c(continuous_cols, Cod_SPro, COD_S11, UNIVERSITY, SCHOOL_NAME))
head(df_categorical)
```

```{r}
lapply(names(df_categorical), function(col) {
  ggplot(df_categorical, aes(x = .data[[col]])) +
    geom_bar() +
    labs(title = paste("Distribution of ", col)) + theme(axis.text.x = element_text(angle = 45, hjust = 1))
})
```

### Regression model

```{r}
# selecting only chosen variables
df$AVG_S11 <- rowMeans(select(df, c(MAT_S11, CR_S11, CC_S11, BIO_S11, ENG_S11)), na.rm = TRUE)
features <- c("AVG_S11", "SEL", "GENDER", "SCHOOL_NAT", "SEL_IHE")
target <- "G_SC"
df_model <- df %>% select(all_of(features), all_of(target))
```

```{r}
head(df_model)
```

```{r}
lr <- lm(G_SC ~ ., data = df_model)
summary(lr)
```

### Residual Plots

```{r}
plot(lr, which = 1)
```

```{r}
# residual plots against each variable
lapply(features, function(feature) {
  ggplot(df_model, aes(x = .data[[feature]], y = lr$residuals)) +
    geom_point() + geom_hline(yintercept = 0, color = "darkblue") +
    labs(title = paste("Residuals vs ", feature)) + xlab(feature) + ylab("Residuals")
})
```

```{r}
# qqplot
qqnorm(lr$residuals)
```

```{r}
# Standardized Residuals
std_residual <- rstandard(lr)
hist(std_residual, breaks = 50, xlab="Standardized Residual", main="Histogram of Standardized Residuals")
```

```{r}
# response vs fitted values
ggplot(df_model, aes(x = lr$fitted.values, y = df$G_SC)) +
  geom_point() + geom_hline(yintercept = 0, color = "darkblue") +
  labs(title = "Residuals vs Fitted Values") + geom_abline(intercept = 0, slope = 1, color="blue") +
  xlab("Fitted Values") + ylab("Global Score")
```
